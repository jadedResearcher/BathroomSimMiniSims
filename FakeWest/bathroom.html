<html>

<head>
  <title>Settlers From The Bathroom</title>
  <link rel="stylesheet" href="index.css">
  <script src="utils.js"></script>
  <script src="canvas_utils.js"></script>
  <script>
    let parent;
    let numButtonsClicked = 0;
    let numButtons = 0;

    let rand = new SeededRandom(13)
    window.onload = () => {
      parent = document.querySelector('#buttons-container')
    }

    //numButtons controls what it looks like initially
    //but how many buttons have been clicked so far decides what it does
    const warpButtonBasedOnNumbers = (button, numButtons, numButtonsClicked)=>{

      //deciding filter status
      if(numButtons<=3){
        return;
      }else if(numButtons >3 && numButtons<13){
        button.style.filter=`saturate(${2*rand.nextDouble()})`
      }else{
        const filters = getBullshitFilters();

        const chosenFilters = [];
        let amount = Math.min(3, numButtons/13);
        for(let i = 0; i<amount; i++){
          chosenFilters.push(rand.pickFrom(filters));
        }
        button.style.filter=` ${chosenFilters.join(" ")}`;

      }
    }

    const renderOneButton = () => {
      numButtons ++;
      const absolute_bullshit = createElementWithClassAndParent("img", parent, "fake-button");
      absolute_bullshit.src = "uhoh.png";
      warpButtonBasedOnNumbers(absolute_bullshit, numButtons,numButtonsClicked)
      absolute_bullshit.onclick = () => {
        renderOneButton();
        numButtonsClicked ++;
      }
    }


    const onMouseDown = () => {
      const b = document.querySelector("#button");
      b.remove();

      for (let i = 0; i < 113; i++) {
        renderOneButton();
      }
      handleScrolling();

    }

    const handleScrolling = () => {
      //throw("JR NOTE: turn scrolling back on later.")
      let lastScrollTime = 0; //not to spam events
      window.onscroll = () => {
        const newTime = new Date().getTime();
        if (((newTime - lastScrollTime)) < 100) {
          return;
        }
        lastScrollTime = newTime;

        window.requestAnimationFrame(() => {
          for (let i = 0; i < 3; i++) {
            renderOneButton();
          }
        });

      };
    }

  </script>
</head>

<body style="background:black;color: red;">
  <center> <img id="button" onmousedown="onMouseDown()" onmouseup="onMouseUp()" style="cursor:pointer;"
      src="button.png" />

    <div id="buttons-container"></div>
    <p>You were warned.</p>
  </center>
</body>

</html>